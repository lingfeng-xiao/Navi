# 个人财务管理系统 - 测试环境配置和数据管理规范

## 1. 文档概述

本文档定义了个人财务管理系统的测试环境配置标准和测试数据管理规范，旨在确保测试环境的一致性、稳定性和可重复性，以及测试数据的安全性、完整性和有效性。

## 2. 测试环境分类

### 2.1 环境类型定义

| 环境类型 | 描述 | 用途 | 维护责任人 |
|---------|------|------|----------|
| **开发测试环境** | 开发者本地环境 | 单元测试、组件测试、开发自测 | 开发团队 |
| **集成测试环境** | 集中式测试环境 | 集成测试、API测试、功能测试 | 测试团队 |
| **预生产环境** | 模拟生产环境 | 验收测试、性能测试、安全测试 | DevOps/测试团队 |
| **生产环境** | 正式运行环境 | 生产验证、监控 | DevOps/运维团队 |

### 2.2 环境配置一致性要求

为确保测试结果的一致性和可靠性，不同环境之间应满足以下一致性要求：

- **操作系统版本和配置**应保持相对一致
- **数据库类型和版本**必须完全一致
- **第三方服务和API版本**应保持一致
- **网络配置和防火墙规则**应尽量保持一致
- **环境变量和配置参数**应根据环境进行适当调整

## 3. 测试环境配置规范

### 3.1 开发测试环境配置

#### 3.1.1 硬件配置要求

| 组件 | 最低配置 | 推荐配置 |
|------|---------|----------|
| CPU | 2核 | 4核或更高 |
| 内存 | 8GB | 16GB |
| 磁盘空间 | 256GB SSD | 512GB SSD |
| 网络 | 千兆网络 | 千兆网络或更高 |

#### 3.1.2 软件配置要求

| 软件/工具 | 版本/规格 | 用途 |
|-----------|-----------|------|
| Node.js | 16.x 或 18.x LTS | JavaScript运行时 |
| npm/yarn | 最新稳定版 | 包管理工具 |
| Git | 2.x 或更高 | 版本控制 |
| Visual Studio Code | 最新版 | 开发IDE |
| Chrome/Firefox | 最新版 | 浏览器测试 |
| Vue DevTools | 最新版 | Vue开发调试 |
| Vite | 项目使用的版本 | 开发服务器 |
| Vitest | 项目使用的版本 | 单元测试框架 |
| Playwright/Cypress | 最新版 | E2E测试框架 |

#### 3.1.3 环境变量配置

在项目根目录创建`.env.development.local`文件，包含以下环境变量：

```
# 开发环境配置
NODE_ENV=development

# API配置
VITE_API_BASE_URL=http://localhost:3000/api

# 数据库配置
VITE_DB_HOST=localhost
VITE_DB_PORT=3306
VITE_DB_NAME=finance_db_dev

# 其他配置
VITE_APP_VERSION=1.0.0-beta
```

### 3.2 集成测试环境配置

#### 3.2.1 硬件配置要求

| 组件 | 最低配置 | 推荐配置 |
|------|---------|----------|
| CPU | 4核 | 8核或更高 |
| 内存 | 16GB | 32GB |
| 磁盘空间 | 512GB SSD | 1TB SSD |
| 网络 | 千兆网络 | 千兆网络或更高 |

#### 3.2.2 软件配置要求

| 软件/工具 | 版本/规格 | 用途 |
|-----------|-----------|------|
| Node.js | 16.x 或 18.x LTS | JavaScript运行时 |
| npm/yarn | 最新稳定版 | 包管理工具 |
| Docker | 最新稳定版 | 容器化部署 |
| Docker Compose | 最新稳定版 | 多容器应用管理 |
| Jenkins/GitLab CI | 最新版 | 持续集成 |
| PostgreSQL/MySQL | 最新稳定版 | 数据库 |
| Redis | 最新稳定版 | 缓存服务 |
| Nginx | 最新稳定版 | 反向代理 |

#### 3.2.3 环境变量配置

在集成测试环境创建`.env.test`文件，包含以下环境变量：

```
# 测试环境配置
NODE_ENV=test

# API配置
VITE_API_BASE_URL=http://test-api.finance-system.com/api

# 数据库配置
VITE_DB_HOST=test-db.finance-system.com
VITE_DB_PORT=3306
VITE_DB_NAME=finance_db_test

# 其他配置
VITE_APP_VERSION=1.0.0-beta
```

### 3.3 预生产环境配置

#### 3.3.1 硬件配置要求

预生产环境配置应与生产环境保持一致或相近，以确保测试结果的可靠性。

| 组件 | 配置要求 |
|------|----------|
| CPU | 与生产环境相同或接近 |
| 内存 | 与生产环境相同或接近 |
| 磁盘空间 | 与生产环境相同或接近 |
| 网络 | 与生产环境相同或接近 |

#### 3.3.2 软件配置要求

预生产环境的软件版本应与生产环境完全一致。

| 软件/工具 | 版本/规格 | 用途 |
|-----------|-----------|------|
| Node.js | 与生产环境相同 | JavaScript运行时 |
| npm/yarn | 与生产环境相同 | 包管理工具 |
| Docker | 与生产环境相同 | 容器化部署 |
| Docker Compose/Kubernetes | 与生产环境相同 | 容器编排 |
| 数据库 | 与生产环境相同 | 数据库服务 |
| 缓存服务 | 与生产环境相同 | 缓存服务 |
| 负载均衡器 | 与生产环境相同 | 负载均衡 |

#### 3.3.3 环境变量配置

在预生产环境创建`.env.staging`文件，包含以下环境变量：

```
# 预生产环境配置
NODE_ENV=staging

# API配置
VITE_API_BASE_URL=http://staging-api.finance-system.com/api

# 数据库配置
VITE_DB_HOST=staging-db.finance-system.com
VITE_DB_PORT=3306
VITE_DB_NAME=finance_db_staging

# 其他配置
VITE_APP_VERSION=1.0.0-rc
```

## 4. 测试环境设置与维护

### 4.1 环境搭建流程

1. **克隆代码库**
   ```bash
   git clone [repository-url]
   cd [project-directory]
   ```

2. **安装依赖**
   ```bash
   npm install
   # 或
   yarn install
   ```

3. **配置环境变量**
   - 复制相应环境的配置文件模板
   - 修改环境变量为当前环境所需的值

4. **启动开发服务器**
   ```bash
   npm run dev
   # 或
   yarn dev
   ```

5. **初始化测试数据**
   ```bash
   npm run db:seed:test
   # 或
   yarn db:seed:test
   ```

### 4.2 环境维护计划

| 维护活动 | 频率 | 负责人 | 内容 |
|---------|------|-------|------|
| 依赖更新检查 | 每周 | 开发/测试团队 | 检查并更新项目依赖 |
| 环境配置检查 | 每两周 | DevOps/测试团队 | 验证环境配置一致性 |
| 性能监控 | 持续 | DevOps/测试团队 | 监控环境性能指标 |
| 日志分析 | 每周 | DevOps/测试团队 | 分析系统日志，识别问题 |
| 环境清理 | 每月 | DevOps/测试团队 | 清理临时文件、日志等 |

### 4.3 环境问题排查

1. **环境差异比较**
   - 使用自动化脚本比较不同环境的配置差异
   - 检查环境变量、依赖版本、系统配置等

2. **常见问题排查清单**
   - 网络连接问题（防火墙、DNS配置）
   - 依赖冲突问题（检查package-lock.json/yarn.lock）
   - 端口占用问题（检查端口使用情况）
   - 权限问题（文件权限、数据库权限）
   - 环境变量问题（检查环境变量配置）

## 5. 测试数据管理规范

### 5.1 测试数据分类

| 数据类型 | 描述 | 示例 | 管理方式 |
|---------|------|------|----------|
| **基础测试数据** | 系统运行必需的基础数据 | 用户角色、系统配置 | 静态数据文件 |
| **业务测试数据** | 业务功能测试所需的数据 | 支出记录、收入记录、债务记录 | 动态生成或导入 |
| **边界测试数据** | 用于边界值测试的数据 | 极大/极小金额、空值、特殊字符 | 动态生成 |
| **异常测试数据** | 用于异常场景测试的数据 | 无效日期、负数金额 | 动态生成 |
| **性能测试数据** | 用于性能测试的大量数据 | 模拟大量交易记录 | 自动化生成 |

### 5.2 测试数据准备策略

1. **数据生成方法**
   - **静态数据文件**：JSON/CSV文件存储的预定义测试数据
   - **数据生成脚本**：使用脚本动态生成测试数据
   - **数据导入工具**：使用ETL工具导入测试数据
   - **Mock数据服务**：提供模拟数据的服务

2. **测试数据集设计原则**
   - **真实性**：测试数据应尽可能接近真实业务场景
   - **完整性**：包含测试所需的所有必要数据元素
   - **隔离性**：不同测试用例的数据应相互隔离
   - **可重复性**：相同测试条件下应能生成相同的测试数据
   - **可维护性**：测试数据应易于更新和维护

### 5.3 测试数据管理工具

| 工具类型 | 推荐工具 | 用途 | 适用场景 |
|---------|----------|------|----------|
| **数据生成工具** | Faker.js | 生成模拟数据 | 单元测试、集成测试 |
| **数据导入工具** | CSV/JSON导入 | 批量导入测试数据 | 集成测试、性能测试 |
| **数据迁移工具** | Knex.js | 数据库迁移和种子 | 开发环境、测试环境 |
| **Mock服务工具** | MSW | API模拟服务 | 前端组件测试 |
| **数据库工具** | pg_dump/mysqldump | 数据库备份和恢复 | 环境迁移、数据复制 |

### 5.4 测试数据隔离策略

1. **隔离级别**
   - **测试用例级别隔离**：每个测试用例使用独立的测试数据
   - **测试套件级别隔离**：每个测试套件使用独立的测试数据
   - **环境级别隔离**：不同环境使用独立的数据库和数据

2. **隔离实现方法**
   - **数据库事务**：使用事务回滚实现测试数据隔离
   - **数据快照**：在测试前后创建和恢复数据库快照
   - **唯一标识符**：为测试数据添加唯一标识符
   - **独立数据库**：为不同测试环境使用独立的数据库实例

### 5.5 测试数据清理策略

1. **清理时机**
   - **测试前清理**：执行测试前清理环境中的旧数据
   - **测试后清理**：每个测试用例执行后清理生成的数据
   - **定期清理**：定期清理测试环境中的历史数据

2. **清理实现方法**
   - **自动化清理脚本**：使用脚本自动清理测试数据
   - **数据库事务回滚**：使用事务确保测试数据不被持久化
   - **数据标记与清理**：为测试数据添加标记，以便批量清理
   - **数据库重置**：在测试套件执行前重置数据库状态

## 6. 测试数据安全管理

### 6.1 敏感数据处理

1. **数据脱敏**
   - 生产数据在用于测试前必须进行脱敏处理
   - 敏感字段（如用户名、手机号、银行卡号）必须使用假数据替换
   - 使用数据脱敏工具确保敏感信息不被泄露

2. **数据加密**
   - 存储在配置文件或环境变量中的敏感信息（如密码、API密钥）必须加密
   - 使用安全的密钥管理系统存储和访问敏感信息

### 6.2 测试数据访问控制

1. **访问权限管理**
   - 测试数据应根据角色和职责设置访问权限
   - 测试环境中的数据库应设置独立的访问凭证
   - 定期审查和更新访问权限

2. **数据传输安全**
   - 测试数据传输应使用加密通道
   - 避免通过不安全渠道（如邮件、聊天工具）传输测试数据

### 6.3 测试数据保留策略

| 数据类型 | 保留期限 | 清理方式 | 负责人 |
|---------|---------|---------|-------|
| 开发测试数据 | 7天 | 自动清理 | 开发团队 |
| 集成测试数据 | 30天 | 自动/手动清理 | 测试团队 |
| 性能测试数据 | 14天 | 手动清理 | 测试团队 |
| 预生产测试数据 | 90天 | 手动清理 | DevOps团队 |

## 7. 测试数据版本控制

### 7.1 测试数据版本管理

1. **数据版本化**
   - 关键测试数据集应进行版本控制
   - 测试数据变更应记录变更日志
   - 测试数据版本应与代码版本保持同步

2. **数据变更管理**
   - 测试数据变更应遵循变更管理流程
   - 重大数据变更应进行评审和批准
   - 变更后应验证所有相关测试用例的有效性

### 7.2 数据版本控制工具

| 工具类型 | 推荐工具 | 用途 | 适用场景 |
|---------|----------|------|----------|
| **代码仓库** | Git | 存储测试数据文件 | 静态测试数据 |
| **数据库版本控制** | Liquibase/Flyway | 管理数据库结构和种子数据 | 结构化测试数据 |
| **数据比对工具** | diff工具 | 比对不同版本的测试数据 | 数据版本验证 |

## 8. 测试环境与数据监控

### 8.1 监控指标

1. **环境监控指标**
   - CPU使用率
   - 内存使用率
   - 磁盘空间
   - 网络流量
   - 服务响应时间
   - 错误率

2. **数据监控指标**
   - 数据库连接数
   - 数据增长趋势
   - 查询响应时间
   - 数据一致性检查

### 8.2 监控工具与告警

| 监控工具类型 | 推荐工具 | 监控内容 | 告警方式 |
|------------|----------|---------|---------|
| **系统监控** | Prometheus + Grafana | 服务器资源使用情况 | 邮件、Slack、短信 |
| **应用监控** | New Relic/Datadog | 应用性能和错误 | 邮件、Slack |
| **数据库监控** | pgAdmin/MySQL Workbench | 数据库性能和状态 | 邮件、Slack |
| **日志监控** | ELK Stack | 系统和应用日志 | 邮件、Slack |

## 9. 最佳实践与建议

### 9.1 测试环境最佳实践

1. **环境即代码**：使用基础设施即代码（IaC）管理测试环境配置
2. **自动化部署**：使用CI/CD流程自动化测试环境的部署和更新
3. **环境标准化**：确保所有环境使用标准化的配置和依赖
4. **定期同步**：保持测试环境与生产环境配置的同步
5. **监控告警**：建立完善的监控和告警机制，及时发现环境问题

### 9.2 测试数据最佳实践

1. **自动化数据准备**：使用脚本自动化测试数据的生成和准备
2. **数据模板化**：使用数据模板提高测试数据的一致性和可维护性
3. **测试数据复用**：设计可复用的测试数据，避免重复创建
4. **数据验证**：定期验证测试数据的有效性和完整性
5. **文档化**：详细记录测试数据的结构、生成方法和使用场景

## 10. 附录

### 10.1 环境配置检查清单
### 10.2 测试数据生成脚本示例
### 10.3 环境搭建故障排除指南
### 10.4 数据安全合规指南

---

**文档版本**: 1.0.0
**创建日期**: 2023年7月1日
**最后更新**: 2023年7月1日
**文档状态**: 初稿

---